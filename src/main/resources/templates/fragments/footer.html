<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>

<footer class="blog-footer bg-inverse" data-th-fragment="footer">
    <!-- JavaScript -->
    <script src="../../js/jquery-3.1.1.min.js" th:src="@{/js/jquery-3.3.1.min.js}"></script>
    <script src="../../js/bootstrap.min.js" th:src="@{/js/bootstrap/bootstrap.min.js}"></script>

    <script src="../../js/jquery.form.min.js" th:src="@{/js/jquery.form.min.js}"></script>
    <script src="../../js/toastr.min.js" th:src="@{/js/toastr.min.js}"></script>
    <script src="../../js/layer/layer.js"></script>
    <script>
        toastr.options = {

            "closeButton": false, //是否显示关闭按钮

            "debug": false, //是否使用debug模式

            "positionClass": "toast-center-center",//弹出窗的位置

            "showDuration": "200",//显示的动画时间

            "hideDuration": "500",//消失的动画时间

            "timeOut": "1000", //展现时间

            "extendedTimeOut": "1000",//加长展示时间

            "showEasing": "swing",//显示时的动画缓冲方式

            "hideEasing": "linear",//消失时的动画缓冲方式

            "showMethod": "fadeIn",//显示时的动画方式

            "hideMethod": "fadeOut" //消失时的动画方式
        };

            $("#fileUpload").change(function () {
                if($(this).val() != ""){
                    var csrfToken = $("meta[name='_csrf']").attr("content");
                    var csrfHeader = $("meta[name='_csrf_header']").attr("content");

                    var formdata=new FormData();
                    for (var i=0;i<$("#fileUpload")[0].files.length;i++) {
                        formdata.append("files",$("#fileUpload")[0].files[i]);
                    }
                    $.ajax({
                        url:"/blogs/uploadPictures",
                        type:"post",
                        data:formdata,
                        processData:false,
                        contentType:false,
                        beforeSend: function(request) {
                            request.setRequestHeader(csrfHeader, csrfToken); // 添加  CSRF Token
                        },
                        success:function(result){
                            var dvPreview = $("#imgPreview");

                            $.each(result.data,function(index,items){
                                var img = $("<img class='bigbigpicture' />");
                                img.attr("src", items.compressPath);
                                dvPreview.append(img);
                                console.info(index+":"+items.path);
                                console.info(index+":"+items.compressPath);
                            });

                        },
                        error:function(e){
                            alert("错误！！");
                        }
                    });
                }

            });

            //$(".bigbigpicture").live("click",function(){
            $(document).on("click", ".bigbigpicture", function () {
                var src = $(this).attr('src');
                var realpath = src.substring(src.lastIndexOf('/'),src.lastIndexOf('g')+1);
                //自定页
                    layer.open({
                        type: 1,
                        skin: 'layui-layer-img', //样式类名
                        closeBtn: 0, //不显示关闭按钮
                        anim: 2,
                        title: false, //不显示标题
                        shadeClose: true, //开启遮罩关闭
                        content: "<img src='"+realpath+"'/>",
                        success:function(layero,index){
                            layer.style(index, {
                                top: '50%',
                                transform:'translateY(-50%)'
                            });
                        }
                    });
            })



    </script>
</footer>

</body>
</html>